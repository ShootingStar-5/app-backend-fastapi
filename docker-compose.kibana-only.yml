version: '3.8'

# 이미 실행 중인 Elasticsearch에 Kibana만 추가
# 사용법: docker-compose -f docker-compose.kibana-only.yml up -d

services:
  kibana:
    image: docker.elastic.co/kibana/kibana:8.11.0
    container_name: health-supplement-kibana
    environment:
      # 호스트 머신의 Elasticsearch에 연결
      - ELASTICSEARCH_HOSTS=http://host.docker.internal:9200
      - SERVER_NAME=kibana
      - SERVER_HOST=0.0.0.0
      - XPACK_SECURITY_ENABLED=false
      - I18N_LOCALE=ko-KR
    ports:
      - "5601:5601"
    extra_hosts:
      # Docker 내부에서 호스트 머신 접근 가능하도록 설정
      - "host.docker.internal:host-gateway"
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:5601/api/status || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s
    restart: unless-stopped
